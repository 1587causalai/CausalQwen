# 战略性回档重塑计划 (Strategic Reset Plan)

**文档状态**: 临时 (Temporary)
**日期**: 2024-06-29

## 1. 背景与动机 (Background & Motivation)

在近期的开发迭代中，我们尝试对 `causal-sklearn` 的核心逻辑进行一系列修复和重构。然而，随着修改的深入，代码库的状态变得愈发复杂和不稳定。直接在当前基础上进行增量式修复，不仅效率低下，还引入了新的、难以预料的 bug。

为了摆脱这种被动局面，我决定暂停当前"打补丁"式的工作模式，采取一种更具战略性的方法来推进项目。核心思想是：**与其修复一个混乱的系统，不如从一个已知的稳定点出发，有选择地、高质量地重新引入我们需要的变更。**

这不仅仅是一次简单的代码回滚，而是一次主动的、有控制的重塑过程。

## 2. 核心策略与已执行步骤 (Core Strategy & Executed Steps)

我采用的核心策略是"**备份隔离，回档重塑**"。具体执行步骤如下：

1.  **完整备份当前工作状态 (Commit & Branch)**
    *   **操作**: 将当前工作目录中所有的修改（包括未完成的、有问题的代码）全部提交。
    *   **命令**: `git add -A && git commit -m "Save current working state with fixes before rollback"`
    *   **目的**: 确保没有任何一行代码丢失。这次提交 `693032b` 成为了我们近期所有探索的一个完整快照。

2.  **创建隔离备份分支 (Isolate in a Backup Branch)**
    *   **操作**: 基于上述提交，创建了一个新的临时分支 `temp-fixes-backup`。
    *   **命令**: `git checkout -b temp-fixes-backup`
    *   **目的**: 将这个包含所有近期变更的、可能不稳定的状态"封存"起来。这个分支现在是我们的"素材库"，而不是开发主线。

3.  **主开发分支回档至稳定版本 (Reset Main Branch)**
    *   **操作**: 切换回主开发分支 `causal-sklearn-mvp`。
    *   **命令**: `git checkout causal-sklearn-mvp`
    *   **操作**: 将该分支强制重置到一个已知的、功能完整的稳定提交版本 `e4da402`。
    *   **命令**: `git reset --hard e4da402`
    *   **目的**: 得到一个干净、可靠、无干扰的开发起点。

## 3. 当前项目状态 (Current Project Status)

截至目前，项目的分支结构和状态如下：

*   **`causal-sklearn-mvp` (当前工作分支)**:
    *   **状态**: 指向稳定的 `e4da402` 提交。
    *   **代码库**: 干净、可预测、功能可靠。
    *   **用途**: 这是我们接下来所有新开发工作的**唯一基准**。

*   **`temp-fixes-backup` (参考与素材分支)**:
    *   **状态**: 保留了回档前的所有修改 (`693032b` 及其历史)。
    *   **代码库**: 包含了所有近期的修复尝试、新功能原型和重构逻辑。
    *   **用途**: **只读的参考分支**。我们绝不直接在此分支上继续开发，而是用它来审视、借鉴和提取有价值的代码片段。

*   **工作目录**:
    *   **状态**: 干净，与 `causal-sklearn-mvp` 分支完全一致。

## 4. 后续行动计划 (Next Steps & Action Plan)

我的下一步是系统性地、有选择地将被隔离的修改重新应用到干净的主分支上。

1.  **审视差异 (Review the Diff)**:
    *   我会做的第一件事是全面比较两个分支的差异，以清晰地了解在 `temp-fixes-backup` 中我们到底做了哪些改动。
    *   **关键命令**: `git diff causal-sklearn-mvp..temp-fixes-backup`

2.  **选择性重构与实现 (Selective Re-implementation & Cherry-picking)**:
    *   我不会全盘接受 `temp-fixes-backup` 中的代码。
    *   对于每一个功能或修复，我会仔细分析其在备份分支中的实现，然后以一种更清晰、更健壮的方式在 `causal-sklearn-mvp` 分支上**重新实现**它。
    *   对于某些独立的、正确的提交，我可能会考虑使用 `git cherry-pick` 将其合并过来，但会非常谨慎。

3.  **小步快跑，持续验证 (Iterate and Validate)**:
    *   每一次只引入一个小的、明确的变更。
    *   每完成一处修改，我都会立即运行相关的测试，确保系统的稳定性没有被破坏。

这个计划能确保我们摆脱此前的困境，在稳固的基础上高质量地完成后续的开发任务。 