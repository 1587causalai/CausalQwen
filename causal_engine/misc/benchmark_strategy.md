# CausalEngine 基准测试协议 (Benchmark Experiment Protocol)

## 1. 引言与实验目标

### 1.1 实验目标
本文档为 CausalEngine 在标准基准数据集上的首次系统性测试，提供官方的、可复现的实验协议。其核心目标包括：
1.  **性能评估**: 在4个分类和4个回归标准数据集上，系统性地评估CausalEngine相对于传统基线模型的性能。
2.  **建立基线**: 为后续所有的模型改进、消融实验和理论探索，建立一个可靠、可解释的性能基准。
3.  **假设验证**: 科学地、分阶段地验证"让模型自主学习全局噪声"这一核心假设的有效性。

### 1.2 指导原则
本次实验所有配置均遵循"科学对照"原则。为了实现清晰的因果归因和结果的可解释性，我们将模型的机制参数（如`b_noise`）视为**固定的、可控的实验条件**或**明确的探索变量**，而非模糊的、混合的优化目标。

---

## 2. 模型架构与数学定义

### 2.1 核心数据流
CausalEngine 的核心数据流将证据特征 $z$（通常为 Transformer 的 `last_hidden_state`）通过两大核心模块，转化为最终的 OvR 概率 $P_{ovr}$。
$$ z \xrightarrow{\text{Abduction}} (\mu_U, \gamma_U) \xrightarrow{\text{Action}} (\mu_S, \gamma_S) \xrightarrow{\text{OvR}} P_{ovr} $$

### 2.2 模块详解：归因网络 (Abduction Network)
该模块负责从证据 $z$ 推断代表个体的柯西分布参数。

-   **数学公式**:
    $$ \text{loc}_{U} = W_{\text{loc}} \cdot z + b_{\text{loc}} $$
    $$ \text{scale}_{U} = \text{softplus}(W_{\text{scale}} \cdot z + b_{\text{scale}}) $$

-   **参数列表**:
    -   `W_loc`, `b_loc`: 用于推断个体分布中心 $\mu_U$ 的可学习权重和偏置。
    -   `W_scale`, `b_scale`: 用于推断个体分布尺度 $\gamma_U$ 的可学习权重和偏置。

### 2.3 模块详解：行动网络 (Action Network)
该模块应用普适因果律，将个体分布映射到决策空间。

-   **数学公式**:
    $$ \text{loc}_{S_k} = W_{\text{cls},k} \cdot \text{loc}_{U} + b_{\text{cls},k} $$
    $$ \text{scale}_{S_k} = (\text{scale}_{U} + |\mathbf{b}_{\text{noise}}|) \cdot |W_{\text{cls},k}| $$

-   **参数列表**:
    -   `W_cls`, `b_cls`: 即 `lm_head`，代表普适因果律的可学习权重和偏置。
    -   `b_noise`: 代表全局环境噪声强度的**可配置参数**（其角色将在实验阶段中定义）。

### 2.4 模块详解：OvR 激活头 (OvR Activation Head)
该模块计算每个决策的最终概率。

-   **数学公式**:
    $$ P_{k} = \frac{1}{2} + \frac{1}{\pi} \arctan\left(\frac{\text{loc}_{S_k} - C_{\text{ovr}}}{\text{scale}_{S_k}}\right) $$

-   **参数列表**:
    -   `C_ovr`: 全局决策阈值的**可配置参数**（其角色将在实验阶段中定义）。

---

## 3. 两阶段实验协议

### 3.1 阶段一：基线验证 (Stage 1: Baseline Validation)

**目标**: 建立科学基线，验证核心因果结构在最纯粹设定下的性能。

**核心参数配置**:
| 参数 | 角色 | 值 |
| :--- | :--- | :--- |
| `b_noise` | **固定超参数** | `0.1` |
| `C_ovr` | **固定超参数** | `0.0` |

**训练超参数**:
| 参数 | 值 | 说明 |
| :--- | :--- | :--- |
| `Optimizer` | `AdamW` | |
| `Learning Rate` | `1e-4` | 线性 warm-up (前10% steps)，然后 cosine decay |
| `Weight Decay` | `0.01` | |
| `Epochs` | `100` | |
| `Early Stopping`| `True` | Patience: 10 epochs, 监控验证集损失 |
| `Batch Size` | `64` | |

**原理阐述**:
此阶段的核心是**控制变量**。通过将 `b_noise` 和 `C_ovr` 固定，我们确保了实验结果的纯粹性，任何性能的提升或变化都直接归因于模型核心权重（`W_*`, `b_*`）的学习能力。这是所有后续分析和比较的基石。

### 3.2 阶段二：自适应优化探索 (Stage 2: Adaptive Optimization)

**目标**: 验证"让模型自主学习全局环境噪声"这一假设，能否带来进一步的性能提升。

**核心参数配置**:
| 参数 | 角色 | 值/状态 |
| :--- | :--- | :--- |
| `W_*`, `b_*` | **可学习权重** | **继承第一阶段训练结果** |
| `b_noise` | **可学习权重** | 从 `0.1` 开始，随梯度更新 |
| `C_ovr` | **固定超参数** | `0.0` |

**训练超参数**:
| 参数 | 值 | 说明 |
| :--- | :--- | :--- |
| `Optimizer` | `AdamW` | |
| `Learning Rate` | `1e-5` | **使用更小的学习率进行微调** |
| `Weight Decay` | `0.01` | |
| `Epochs` | `50` | |
| `Early Stopping`| `True` | Patience: 10 epochs, 监控验证集损失 |
| `Batch Size` | `64` | |

**原理阐述**:
在拥有一个可靠的基线后，将 `b_noise` 切换为可学习模式，是为了探索一个更高级的科学问题：模型能否通过数据，自主学习并解耦（Disentangle）两种不同来源的不确定性（个体不确定性 vs. 全局不确定性），从而获得更优的性能。

---

## 4. 评估与分析

### 4.1 评估指标
-   **分类任务**: Accuracy, F1-Score (Macro), Precision, Recall
-   **回归任务**: Mean AbsoluteError (MAE), Root Mean Squared Error (RMSE), Median Absolute Error (MdAE), MSE, R²

### 4.2 对比分析
实验报告应至少包含以下两个核心对比：
1.  **CausalEngine vs. 传统基线**: 将**阶段一**的结果与标准MLP基线模型进行对比，以验证CausalEngine核心架构的有效性。
2.  **自适应 vs. 固定噪声**: 将**阶段二**的结果与**阶段一**进行对比，以量化自主学习`b_noise`所带来的性能变化。

---

## Appendix: 核心设计理念问答 (Core Design Rationale FAQ)

### Q1: CausalEngine特有的参数体系是什么？

CausalEngine引入了两组全新的参数，用于实现其核心的因果推理机制：

1.  **归因网络 (`AbductionNetwork`)**:
    *   `W_loc`, `b_loc`: 推断个体群体**中心** `μ`。
    *   `W_scale`, `b_scale`: 推断个体群体**多样性** `γ`。
2.  **行动网络与激活头 (`ActionNetwork` & `OvR Head`)**:
    *   `W_cls`, `b_cls`: 代表**普适因果律 `f`**。
    *   `b_noise`: 代表**全局环境噪声 `ε`** 的强度。
    *   `C_ovr`: 代表**全局决策阈值**。

其中，`W_*` 和 `b_*` 通常作为可学习权重，而 `b_noise` 和 `C_ovr` 的角色则根据实验目的进行配置。

### Q2: 为什么实验第一阶段要将 `b_noise` 固定为超参数？

将 `b_noise` 在初始阶段固定，其首要的、具有战略意义的考量是**科学方法论**：

> **首先将 `b_noise` 视为一个可控、固定的超参数，我们后续的这些高级实验才具有清晰的、可解释的基线和对照组。**

这使得模型从一个纯粹的"黑盒"变成了一个可供科学研究的"仪器"。这个决策背后有三个核心考量：
1.  **建立可解释的实验基线 (最重要的原因)**: 这是进行科学对比分析的基石。
2.  **强制职责清晰**: 确保模型能学习到由数据驱动的、真正的个体不确定性 (`scale_U`)，而非将其与全局环境噪声 (`b_noise`) 相混淆。
3.  **简化优化，增加稳定性**: 遵循"不要引入不必要的自由度"这一核心实践准则，使训练过程更鲁棒。

### Q3: `b_noise` 和 `W_cls` 的功能不会冗余吗？为什么还要探索 `b_noise` 的可学习性？

这是一个非常深刻的问题。`b_noise` 并非冗余，而是一个**逻辑上必要、用于解耦的关键参数**。

`W_cls` 和 `b_noise` 捕捉了两个完全不同层面的信息：
-   **`W_cls` 是"局部"和"具体"的**：它代表了从个体特征到**每一个具体词汇**的映射规则。
-   **`b_noise` 是"全局"和"抽象"的**：它代表了任务环境**整体的、与具体词汇无关的**固有不确定性。

让 `b_noise` 在实验第二阶段可学习，其目的在于探索模型**解耦"具体知识"和"环境属性"**的能力。如果模型能学到一个更"纯粹"的 `W_cls`（只负责语义关联），同时用一个独立的 `b_noise` 来学习任务的整体不确定性，那么它就可能获得一个更鲁棒、更可解释的内部表示。这正是我们进行第二阶段实验想要验证的核心科学问题。 