# CausalEngine v2.0.5 Release Notes

## 发布日期
2024-12-27

## 新特性

### 🧮 CauchyMath 工具类大幅扩展

基于用户建议，我们大幅扩展了 `CauchyMath` 工具类，添加了完整的柯西分布数学函数集合，使其成为一个功能完整的柯西分布计算库。

#### 新增函数

**1. 基础分布函数**
- `cauchy_pdf(x, loc, scale)` - 概率密度函数
  - 数学公式：$f(x) = \frac{1}{\pi \gamma [1 + ((x-\mu)/\gamma)^2]}$
  
- `cauchy_cdf(x, loc, scale)` - 累积分布函数
  - 数学公式：$F(x) = \frac{1}{2} + \frac{1}{\pi}\arctan\left(\frac{x-\mu}{\gamma}\right)$
  
- `cauchy_survival(x, loc, scale)` - 生存函数
  - 数学公式：$S(x) = P(X > x) = \frac{1}{2} - \frac{1}{\pi}\arctan\left(\frac{x-\mu}{\gamma}\right)$

**2. 高级数值函数**
- `cauchy_log_pdf(x, loc, scale)` - 对数概率密度函数
  - 用于数值稳定的似然计算
  - 数学公式：$\log f(x) = -\log(\pi) - \log(\gamma) - \log(1 + ((x-\mu)/\gamma)^2)$

- `cauchy_quantile(p, loc, scale)` - 分位函数（逆CDF）
  - 用于从均匀分布采样生成柯西分布样本
  - 数学公式：$F^{-1}(p) = \mu + \gamma \cdot \tan(\pi(p - 1/2))$

#### 使用示例

```python
from causal_engine import CauchyMath
import torch

# 标准柯西分布
loc, scale = torch.tensor(0.0), torch.tensor(1.0)
x = torch.tensor(1.0)

# 基础函数
pdf = CauchyMath.cauchy_pdf(x, loc, scale)        # 0.1592
cdf = CauchyMath.cauchy_cdf(x, loc, scale)        # 0.75
survival = CauchyMath.cauchy_survival(x, loc, scale)  # 0.25

# 高级函数
log_pdf = CauchyMath.cauchy_log_pdf(x, loc, scale)   # -1.8379
quantile = CauchyMath.cauchy_quantile(torch.tensor(0.75), loc, scale)  # 1.0

# 采样
uniform_samples = torch.rand(1000)
cauchy_samples = CauchyMath.cauchy_quantile(uniform_samples, loc, scale)
```

## 验证与测试

### 🧪 完整数学验证

新增测试脚本 `scripts/test_cauchy_math.py`，包含以下验证：

1. **基本性质验证** ✅
   - PDF 积分 ≈ 1.0
   - CDF + Survival = 1.0
   - CDF(μ) = 0.5

2. **分位函数与CDF互逆性** ✅
   - 最大误差 < 3e-08
   - 完美的数学一致性

3. **参数影响分析** ✅
   - 位置参数μ的影响
   - 尺度参数γ的影响

4. **线性稳定性** ✅
   - 验证现有的线性变换函数
   - 误差 < 1e-16

5. **采样一致性** ✅
   - 经验CDF vs 理论CDF
   - 误差 < 2%

6. **数值稳定性** ✅
   - 极端值测试 (±100)
   - 所有函数返回有限值

7. **可视化验证** ✅
   - 自动生成分布图
   - 验证不同参数的影响

### 📊 测试结果摘要

```
📋 测试总结:
✅ 基本性质验证
✅ 分位函数与CDF互逆性  
✅ 参数影响分析
✅ 线性稳定性
✅ 采样一致性
✅ 数值稳定性
✅ 可视化验证
```

## 工程改进

### 📚 文档完善

- **代码注释**：所有新函数都包含详细的数学公式和用途说明
- **类型提示**：完整的 PyTorch Tensor 类型注解
- **用法示例**：每个函数都有清晰的使用示例

### 🔧 API 设计

- **统一接口**：所有函数都遵循 `(x, loc, scale)` 的参数顺序
- **广播支持**：支持标量和张量的灵活组合
- **数值稳定**：特别优化了极端值的处理

## 应用价值

### 🎯 实际用途

1. **损失函数设计**：`cauchy_log_pdf` 可用于设计柯西分布的负对数似然损失
2. **采样和生成**：`cauchy_quantile` 支持高效的逆变换采样
3. **概率计算**：`cauchy_cdf` 和 `cauchy_survival` 用于精确的概率计算
4. **统计分析**：完整的分布函数集合支持深入的统计分析

### 🔬 研究支持

- **理论验证**：研究人员可以验证柯西分布的数学性质
- **算法开发**：为新的因果推理算法提供数学工具
- **教学辅助**：可用于教学演示柯西分布的特性

## 兼容性

- **完全向后兼容**：现有代码无需修改
- **无依赖增加**：仅使用 PyTorch 内置函数
- **性能优化**：所有函数都支持 GPU 加速

## 未来展望

CauchyMath 现在是一个功能完整的柯西分布计算库，为 CausalEngine 的数学基础提供了强大支持。这为未来的扩展奠定了坚实基础：

- 支持更复杂的分布计算
- 便于实现新的激活函数
- 为研究和教学提供完整工具

## 致谢

感谢用户的宝贵建议，推动了这次重要的功能扩展！ 