# CausalQwen é‡æ„æ€»ç»“

## ğŸš€ é‡æ„ç›®æ ‡ï¼šä¸Qwenå®Œå…¨å…¼å®¹

åŸºäºç”¨æˆ·è¦æ±‚"å¤§åˆ€é˜”æ–§çš„æ”¹åŠ¨ï¼Œä¸åŸæ¥çš„Qwenå…¼å®¹"ï¼Œå®Œæˆäº†å…¨é¢çš„æ¶æ„ç®€åŒ–å’Œæ¥å£ç»Ÿä¸€ã€‚

## âœ… ä¸»è¦æ”¹è¿›

### 1. **æ¥å£å®Œå…¨å…¼å®¹Qwen**
- ç§»é™¤è‡ªå®šä¹‰çš„`mode='deterministic'`å‚æ•°
- ç»Ÿä¸€ä½¿ç”¨æ ‡å‡†çš„`do_sample`å‚æ•°
- å®Œæ•´æ”¯æŒQwençš„æ‰€æœ‰ç”Ÿæˆå‚æ•°ï¼š`temperature`, `top_k`, `top_p`, `max_new_tokens`

```python
# ä¹‹å‰ï¼ˆå¤æ‚ï¼‰
output = model.inference(input_ids, mode='deterministic')
output = model.inference(input_ids, mode='sampling', temperature=1.0)

# ç°åœ¨ï¼ˆä¸Qwenç›¸åŒï¼‰
output = model.generate(input_ids, do_sample=False)              # ç¡®å®šæ€§
output = model.generate(input_ids, do_sample=True, temperature=0.8)  # é‡‡æ ·
```

### 2. **ä»£ç å¤§å¹…ç®€åŒ–**
- ç›´æ¥è¦†ç›–`CausalInferenceEngineV2` â†’ `CausalInferenceEngine`
- ç§»é™¤æ‰€æœ‰V2åç¼€å’Œå¤æ‚çš„æ¨¡å¼å‚æ•°
- ç»Ÿä¸€æ¨ç†æ¥å£ï¼Œå‡å°‘æ¦‚å¿µå¤æ‚åº¦

### 3. **V2æ•°å­¦åŸç†ä¿æŒä¸å˜**
```
do_sample=False: U' ~ Cauchy(Î¼, Î³ + |b_noise|)     # å™ªå£°å½±å“å°ºåº¦å‚æ•°
do_sample=True:  U' ~ Cauchy(Î¼ + TÂ·|b_noise|Â·Îµ, Î³) # å™ªå£°å½±å“ä½ç½®å‚æ•°
```

## ğŸ“ é‡æ„çš„æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
- `src/causal_qwen_mvp/inference.py` - å®Œå…¨é‡å†™ï¼Œå…¼å®¹Qwenæ¥å£
- `src/causal_qwen_mvp/models.py` - æ›´æ–°æ¨ç†æ–¹æ³•ä¸º`generate()`
- `src/causal_qwen_mvp/__init__.py` - ç®€åŒ–å¯¼å‡ºï¼Œç§»é™¤V2åç¼€

### æ–°å¢æµ‹è¯•
- `scripts/qwen_compatibility_test.py` - å…¨é¢çš„å…¼å®¹æ€§éªŒè¯
- `scripts/simple_demo_v2.py` - ç®€æ´çš„ä½¿ç”¨æ¼”ç¤º

## ğŸ§ª éªŒè¯ç»“æœ

### Qwenå…¼å®¹æ€§æµ‹è¯• (4/4 é€šè¿‡)
âœ… ç”Ÿæˆæ¥å£å…¼å®¹æ€§  
âœ… V2æ•°å­¦åŸç†éªŒè¯  
âœ… æ¸©åº¦å‚æ•°æ•ˆæœ  
âœ… æ‰¹é‡ç”ŸæˆåŠŸèƒ½  

### å…³é”®æŒ‡æ ‡
- **do_sampleå·®å¼‚æ€§**: ç¡®å®šæ€§vsé‡‡æ · 100% ä¸åŒï¼ˆ5/5ä½ç½®ï¼‰
- **ä½ç½®å‚æ•°å·®å¼‚**: 0.93ï¼ˆæ˜¾è‘—å·®å¼‚ï¼Œç¬¦åˆV2è®¾è®¡ï¼‰
- **æ¸©åº¦å¤šæ ·æ€§**: 4/5ç§æ¸©åº¦äº§ç”Ÿä¸åŒåºåˆ—
- **æ•°å­¦åŸç†**: ä½ç½®vså°ºåº¦å·®å¼‚éªŒè¯é€šè¿‡

## ğŸ¯ ä½¿ç”¨æ–¹å¼ï¼ˆä¸Qwenå®Œå…¨ç›¸åŒï¼‰

```python
from causal_qwen_mvp import CausalQwenMVPForCausalLM, CausalQwen2Config

# åˆ›å»ºæ¨¡å‹ï¼ˆä¸Qwenç›¸åŒï¼‰
config = CausalQwen2Config.from_pretrained("Qwen/Qwen2.5-0.5B")
model = CausalQwenMVPForCausalLM(config)

# ç¡®å®šæ€§ç”Ÿæˆï¼ˆV2ï¼šå™ªå£°å½±å“å°ºåº¦å‚æ•°ï¼‰
output = model.generate(
    input_ids,
    max_new_tokens=20,
    do_sample=False
)

# é‡‡æ ·ç”Ÿæˆï¼ˆV2ï¼šå™ªå£°å½±å“ä½ç½®å‚æ•°ï¼‰
output = model.generate(
    input_ids,
    max_new_tokens=20,
    do_sample=True,
    temperature=0.8,
    top_k=50,
    top_p=0.9
)
```

## ğŸ”¬ V2æ ¸å¿ƒåˆ›æ–°

**ç»Ÿä¸€ActionNetworkæ¡†æ¶**ï¼š
- `do_sample=False`: å¤–ç”Ÿå™ªå£°èåˆåˆ°å°ºåº¦å‚æ•°ï¼Œå¢åŠ å†³ç­–ä¸ç¡®å®šæ€§
- `do_sample=True`: æ ‡å‡†å™ªå£°æ³¨å…¥ä½ç½®å‚æ•°ï¼Œæ‰°åŠ¨ä¸ªä½“èº«ä»½  
- `temperature`: ä»…åœ¨é‡‡æ ·æ¨¡å¼ä¸‹æ§åˆ¶å™ªå£°å¼ºåº¦

**æ•°å­¦ä¸¥è°¨æ€§**ï¼š
- æ¯è¡Œä»£ç å¯¹åº”æ˜ç¡®æ•°å­¦å…¬å¼
- å®Œæ•´çš„æŸ¯è¥¿åˆ†å¸ƒçº¿æ€§ç¨³å®šæ€§å®ç°
- æ¸©åº¦å‚æ•°é€‰æ‹©æ€§ç”Ÿæ•ˆæœºåˆ¶

## ğŸ“ˆ é‡æ„æ”¶ç›Š

1. **ç”¨æˆ·ä½“éªŒ**: æ— éœ€å­¦ä¹ æ–°æ¥å£ï¼Œç›´æ¥ä½¿ç”¨Qwenç»éªŒ
2. **ä»£ç è´¨é‡**: å¤§å¹…ç®€åŒ–ï¼Œç§»é™¤å†—ä½™æ¦‚å¿µ
3. **ç»´æŠ¤æ€§**: ç»Ÿä¸€æ¶æ„ï¼Œå‡å°‘å¤æ‚åº¦
4. **å…¼å®¹æ€§**: å®Œç¾ç»§æ‰¿Qwenç”Ÿæ€ç³»ç»Ÿ

## ğŸš€ æ€»ç»“

é€šè¿‡è¿™æ¬¡é‡æ„ï¼ŒCausalQwenå®ç°äº†ï¼š
- âœ… ä¸Qwenå®Œå…¨å…¼å®¹çš„æ¥å£
- âœ… ä¿æŒV2æ•°å­¦åˆ›æ–°çš„æ ¸å¿ƒ
- âœ… å¤§å¹…ç®€åŒ–çš„ä»£ç æ¶æ„
- âœ… å®Œæ•´çš„æµ‹è¯•éªŒè¯è¦†ç›–

**CausalQwenç°åœ¨å¯ä»¥ä½œä¸ºQwençš„ç›´æ¥æ›¿æ¢ä½¿ç”¨ï¼ŒåŒæ—¶æä¾›é©å‘½æ€§çš„å› æœæ¨ç†èƒ½åŠ›ï¼**